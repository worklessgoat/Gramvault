<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#050505">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>GRAMVAULT | INSTITUTIONAL EXECUTION</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* * SYSTEM DESIGN TOKENS 
         * Theme: "Dark Axiom" 
         */
        :root {
            --bg-root: #050505;
            --bg-panel: #0a0a0a;
            --bg-card: #111111;
            
            --border-light: rgba(255, 255, 255, 0.08);
            --border-hover: rgba(255, 255, 255, 0.15);
            
            --col-solana: #14F195;
            --col-purple: #9945FF;
            --col-danger: #ef4444;
            --col-warn: #eab308;
            --col-text-main: #ffffff;
            --col-text-muted: #888888;
            
            --font-ui: 'Inter', sans-serif;
            --font-data: 'JetBrains Mono', monospace;
            
            --ease-quart: cubic-bezier(0.165, 0.84, 0.44, 1);
        }

        /* --- RESET & BASE --- */
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: var(--bg-root); color: var(--col-text-main); font-family: var(--font-ui); overflow: hidden; }

        /* --- UTILITIES --- */
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 8px; } .gap-4 { gap: 16px; }
        .text-mono { font-family: var(--font-data); }
        .text-sm { font-size: 0.8rem; }
        .text-xs { font-size: 0.7rem; }
        .text-green { color: var(--col-solana); }
        .text-red { color: var(--col-danger); }
        .text-muted { color: var(--col-text-muted); }
        .uppercase { text-transform: uppercase; }
        .hidden { display: none !important; opacity: 0; pointer-events: none; }
        .full-width { width: 100%; }
        
        /* --- SVGs (Icon System) --- */
        .icon { width: 18px; height: 18px; fill: none; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
        .icon-sm { width: 14px; height: 14px; }
        .icon-lg { width: 24px; height: 24px; }

        /* --- COMPONENTS --- */
        .btn {
            background: rgba(255,255,255,0.03); border: 1px solid var(--border-light); color: #fff;
            padding: 10px 16px; border-radius: 6px; font-family: var(--font-data); font-size: 0.75rem; font-weight: 600;
            cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; justify-content: center; gap: 8px; letter-spacing: 0.5px;
        }
        .btn:hover { background: rgba(255,255,255,0.08); border-color: var(--col-solana); color: var(--col-solana); }
        .btn:active { transform: translateY(1px); }
        
        .btn-primary {
            background: var(--col-solana); color: #000; border: none;
        }
        .btn-primary:hover { background: #00ffaa; color: #000; box-shadow: 0 0 20px rgba(20, 241, 149, 0.4); }

        .input-group { position: relative; width: 100%; margin-bottom: 15px; }
        .input-std {
            width: 100%; background: #000; border: 1px solid var(--border-light); color: #fff;
            padding: 14px; border-radius: 6px; font-family: var(--font-data); font-size: 0.9rem; transition: 0.3s;
        }
        .input-std:focus { border-color: var(--col-solana); box-shadow: 0 0 0 2px rgba(20, 241, 149, 0.1); }
        .input-label { position: absolute; top: -8px; left: 10px; background: #09090b; padding: 0 5px; font-size: 0.7rem; color: var(--col-text-muted); }

        .badge {
            padding: 2px 6px; border-radius: 3px; font-family: var(--font-data); font-size: 0.65rem; letter-spacing: 1px;
            background: rgba(255,255,255,0.05); border: 1px solid var(--border-light);
        }
        .badge-live { background: rgba(20, 241, 149, 0.1); color: var(--col-solana); border-color: rgba(20, 241, 149, 0.3); display: flex; align-items: center; gap: 4px; }
        .pulse-dot { width: 6px; height: 6px; background: currentColor; border-radius: 50%; animation: pulse 1.5s infinite; }

        /* --- ANIMATIONS --- */
        @keyframes pulse { 0% { opacity: 0.4; } 50% { opacity: 1; } 100% { opacity: 0.4; } }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); } 20%, 40%, 60%, 80% { transform: translateX(5px); } }

        /* --- BACKGROUND FX --- */
        #bg-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.3; pointer-events: none; }
        .scanlines {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.05) 50%); background-size: 100% 4px;
        }

        /* --- LAYOUT STRUCTURE --- */
        .app-container {
            display: grid; 
            grid-template-rows: 60px 1fr; 
            height: 100vh;
            width: 100vw;
            opacity: 0; /* Hidden by default until login */
            transition: opacity 0.8s ease-in-out;
        }

        /* Header */
        .header {
            background: var(--bg-panel); border-bottom: 1px solid var(--border-light);
            display: flex; align-items: center; justify-content: space-between; padding: 0 24px;
            z-index: 50; backdrop-filter: blur(10px);
        }
        .logo-area { display: flex; align-items: center; gap: 10px; font-weight: 700; letter-spacing: -0.5px; font-size: 1.1rem; }
        .nav-items { display: flex; gap: 20px; margin-left: 40px; }
        .nav-link { font-size: 0.85rem; color: var(--col-text-muted); cursor: pointer; transition: 0.2s; }
        .nav-link:hover, .nav-link.active { color: #fff; }

        /* Body Grid */
        .workspace {
            display: grid;
            grid-template-columns: 280px 1fr 320px; /* Left Sidebar | Main | Right Sidebar */
            overflow: hidden;
            position: relative;
        }

        /* Sidebars */
        .sidebar {
            background: var(--bg-panel); border-right: 1px solid var(--border-light);
            display: flex; flex-direction: column; overflow-y: auto;
        }
        .sidebar-right {
            background: var(--bg-panel); border-left: 1px solid var(--border-light);
            display: flex; flex-direction: column; overflow-y: auto;
        }
        
        .panel-header {
            padding: 12px 16px; border-bottom: 1px solid var(--border-light);
            font-family: var(--font-data); font-size: 0.75rem; color: var(--col-text-muted); font-weight: 700;
            display: flex; justify-content: space-between; align-items: center;
        }

        /* Main Center */
        .main-view {
            background: var(--bg-root); overflow-y: auto; padding: 24px;
            display: flex; flex-direction: column; gap: 24px;
        }

        /* --- WIDGETS --- */
        .card {
            background: var(--bg-card); border: 1px solid var(--border-light); border-radius: 8px;
            overflow: hidden; position: relative;
        }

        /* Balance Hero */
        .hero-section {
            display: flex; justify-content: space-between; align-items: flex-end; padding: 30px;
            background: linear-gradient(180deg, rgba(20,241,149,0.03) 0%, rgba(0,0,0,0) 100%);
        }
        .bal-val { 
            font-family: var(--font-data); 
            font-size: clamp(2.5rem, 5vw, 4rem); /* Responsive Font Size */
            font-weight: 700; line-height: 1; letter-spacing: -1px; margin: 10px 0; 
        }
        .bal-pnl { display: flex; align-items: center; gap: 6px; color: var(--col-solana); font-family: var(--font-data); font-size: 0.9rem; }
        
        /* Chart */
        .chart-container { height: 400px; width: 100%; position: relative; background: #080808; }
        
        /* List Items */
        .list-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px 16px; border-bottom: 1px solid var(--border-light);
            font-size: 0.85rem; transition: 0.2s;
        }
        .list-item:hover { background: rgba(255,255,255,0.02); }
        .list-icon { width: 32px; height: 32px; border-radius: 50%; background: #222; display: flex; align-items: center; justify-content: center; color: #666; }

        /* --- MODALS --- */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000;
            display: flex; align-items: center; justify-content: center; backdrop-filter: blur(15px);
        }
        .modal {
            background: #09090b; border: 1px solid var(--border-light); width: 90%; max-width: 440px;
            border-radius: 12px; overflow: hidden; box-shadow: 0 50px 100px -20px rgba(0,0,0,0.7);
            animation: slideIn 0.3s var(--ease-quart);
        }
        .modal-body { padding: 30px; }
        .modal-footer { padding: 20px 30px; background: #111; border-top: 1px solid var(--border-light); display: flex; gap: 10px; }

        /* Login Specific */
        .shake-anim { animation: shake 0.4s ease-in-out; }

        /* Loader specific */
        .loader-ring {
            width: 50px; height: 50px; border: 3px solid rgba(255,255,255,0.1); border-top: 3px solid var(--col-solana);
            border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px auto;
        }
        .step-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-family: var(--font-data); font-size: 0.85rem; color: #666; }
        .step-row.active { color: #fff; }
        .step-row.done span:last-child { color: var(--col-solana); }

        /* --- RESPONSIVE MEDIA QUERIES --- */
        @media (max-width: 1200px) {
            .workspace { grid-template-columns: 240px 1fr; }
            .sidebar-right { display: none; }
        }
        @media (max-width: 900px) {
            .workspace { grid-template-columns: 1fr; }
            .sidebar { display: none; }
            .nav-items { display: none; }
            .hero-section { flex-direction: column; align-items: flex-start; gap: 20px; }
            .header { padding: 0 15px; }
            .logo-area span { display: none; } /* Hide "PRO" badge on tiny screens if needed */
            .main-view { padding: 15px; gap: 15px; }
        }
    </style>
</head>
<body>

    <canvas id="bg-canvas"></canvas>
    <div class="scanlines"></div>

    <div id="view-login" class="modal-overlay">
        <div class="modal" id="login-modal-box" style="border-top: 3px solid var(--col-solana);">
            <div class="modal-body" style="text-align: center;">
                <div style="margin-bottom: 20px;">
                    <svg width="48" height="48" viewBox="0 0 397 311" fill="none"><path d="M64.6 237.9c2.4-2.4 5.7-3.8 9.2-3.8h317.4c5.8 0 8.7 7 4.6 11.1l-62.7 62.7c-2.4 2.4-5.7 3.8-9.2 3.8H6.5c-5.8 0-8.7-7-4.6-11.1l62.7-62.7zM6.5 102.7h317.4c3.5 0 6.8-1.4 9.2-3.8l62.7-62.7C399.9 32.1 397 25 391.2 25H73.8c-3.5 0-6.8 1.4-9.2 3.8L1.9 91.6c-4.1 4.1-1.2 11.1 4.6 11.1zM391.2 142.6H73.8c-3.5 0-6.8 1.4-9.2 3.8L1.9 209.1c-4.1 4.1-1.2 11.1 4.6 11.1h317.4c3.5 0 6.8-1.4 9.2-3.8l62.7-62.7c4.1-4.2 1.2-11.1-4.6-11.1z" fill="url(#grad1)"/><defs><linearGradient id="grad1" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#14F195"/><stop offset="1" stop-color="#9945FF"/></linearGradient></defs></svg>
                </div>
                <h2 style="font-family: var(--font-data); margin: 0 0 10px 0; letter-spacing: -1px;">TERMINAL ACCESS</h2>
                <p style="color: var(--col-text-muted); font-size: 0.9rem; margin-bottom: 30px;">Institutional Execution Environment</p>
                
                <div class="input-group">
                    <span class="input-label">IDENTITY</span>
                    <input type="text" id="inp-id" class="input-std" placeholder="Terminal ID">
                </div>
                <div class="input-group">
                    <span class="input-label">KEY</span>
                    <input type="password" id="inp-key" class="input-std" placeholder="Access Token">
                </div>
                
                <div id="login-err" style="height: 20px; color: var(--col-danger); font-size: 0.8rem; font-family: var(--font-data); margin-bottom: 10px;"></div>
                
                <button class="btn btn-primary" style="width: 100%; justify-content: center; height: 48px;" onclick="Engine.login()">
                    ESTABLISH SECURE UPLINK
                </button>
            </div>
            <div style="background: #000; padding: 10px; font-size: 0.7rem; color: #444; text-align: center; font-family: var(--font-data); border-top: 1px solid var(--border-light);">
                ENCRYPTED VIA SOLANA MPC PROTOCOL
            </div>
        </div>
    </div>

    <div id="view-docs" class="modal-overlay hidden">
        <div class="modal" style="max-width: 600px;">
            <div class="panel-header">
                <span>STRATEGY WHITEPAPER</span>
                <span style="cursor: pointer;" onclick="Engine.toggle('view-docs', false)">âœ•</span>
            </div>
            <div class="modal-body" style="overflow-y: auto; max-height: 400px;">
                <div style="margin-bottom: 24px;">
                    <h4 style="color: var(--col-solana); font-family: var(--font-data); margin: 0 0 8px 0;">01. ATOMIC ARBITRAGE</h4>
                    <p style="color: #aaa; font-size: 0.9rem; line-height: 1.6;">The GramVault engine monitors liquidity across Raydium, Orca, and Jupiter. When price displacement >0.1% occurs, atomic bundles are executed to capture value in the same block.</p>
                </div>
                <div style="margin-bottom: 24px;">
                    <h4 style="color: var(--col-solana); font-family: var(--font-data); margin: 0 0 8px 0;">02. MEV PROTECTION</h4>
                    <p style="color: #aaa; font-size: 0.9rem; line-height: 1.6;">Transactions are routed via private Jito-Solana validators, bypassing public mempools to ensure zero sandwich attacks.</p>
                </div>
                <div>
                    <h4 style="color: var(--col-solana); font-family: var(--font-data); margin: 0 0 8px 0;">03. YIELD LOGIC</h4>
                    <p style="color: #aaa; font-size: 0.9rem; line-height: 1.6;">Profits are auto-compounded daily. The mathematical target is set to 2.40 SOL/day for this tier.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn full-width" onclick="Engine.toggle('view-docs', false)">CLOSE</button>
            </div>
        </div>
    </div>

    <div id="view-withdraw" class="modal-overlay hidden">
        <div class="modal">
            <div class="panel-header">
                <span>WITHDRAWAL REQUEST</span>
                <span style="cursor: pointer;" onclick="Engine.toggle('view-withdraw', false)">âœ•</span>
            </div>
            <div class="modal-body">
                <div style="background: rgba(255,255,255,0.03); padding: 12px; border-radius: 6px; margin-bottom: 20px; display: flex; justify-content: space-between;">
                    <span class="text-sm text-muted">Available Balance</span>
                    <span class="text-mono text-green" id="modal-bal">0.0000 SOL</span>
                </div>
                <div class="input-group">
                    <span class="input-label">DESTINATION</span>
                    <input type="text" class="input-std" placeholder="Solana Wallet Address">
                </div>
                <div class="input-group">
                    <span class="input-label">AMOUNT</span>
                    <input type="number" class="input-std" placeholder="0.00">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="Engine.toggle('view-withdraw', false)">CANCEL</button>
                <button class="btn btn-primary" style="flex: 1;" onclick="Engine.submitWithdraw()">CONFIRM TRANSFER</button>
            </div>
        </div>
    </div>

    <div id="view-loading" class="modal-overlay hidden">
        <div class="modal" style="width: 400px; text-align: center;">
            <div class="modal-body">
                <div class="loader-ring"></div>
                <h3 style="margin: 0 0 20px 0; font-family: var(--font-data);">VERIFYING PROTOCOL</h3>
                <div id="loading-steps">
                    <div class="step-row" id="s1"><span>Validating Wallet Address</span><span>WAITING</span></div>
                    <div class="step-row" id="s2"><span>Checking Liquidity Depth</span><span>WAITING</span></div>
                    <div class="step-row" id="s3"><span>Risk Analysis Engine</span><span>WAITING</span></div>
                    <div class="step-row" id="s4"><span>Collateral Requirement</span><span>WAITING</span></div>
                </div>
            </div>
        </div>
    </div>

    <div id="view-error" class="modal-overlay hidden">
        <div class="modal" style="border-top: 4px solid var(--col-danger);">
            <div class="modal-body">
                <div style="margin-bottom: 15px; color: var(--col-danger);">
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                </div>
                <h3 style="margin: 0 0 10px 0;">SECURITY PROTOCOL ACTIVE</h3>
                
                <p style="font-size: 0.9rem; line-height: 1.6; color: #ccc; margin-bottom: 24px;">
                    This is a High-Value Institutional Account. To prevent liquidity draining and verify on-chain ownership, a <strong style="color: #fff">refundable collateral</strong> is required by the Smart Contract.
                </p>

                <div style="background: rgba(20,241,149,0.05); border: 1px solid var(--col-solana); padding: 16px; border-radius: 6px; margin-bottom: 24px;">
                    <div class="text-xs text-green uppercase" style="margin-bottom: 4px;">Pending Action</div>
                    <div style="font-family: var(--font-data); font-size: 1.1rem; font-weight: 700;">Deposit 9.7 SOL Collateral</div>
                </div>

                <p style="font-size: 0.8rem; color: var(--col-text-muted); line-height: 1.5;">
                    *This amount is held in escrow and is 100% refundable. It will be released along with your full profits automatically after 3 block confirmations (approx 2 minutes).
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn full-width" onclick="Engine.toggle('view-error', false)">ACKNOWLEDGE</button>
            </div>
        </div>
    </div>

    <div id="main-app" class="app-container">
        
        <header class="header">
            <div class="logo-area">
                <svg width="24" height="24" viewBox="0 0 397 311" fill="none"><path d="M64.6 237.9c2.4-2.4 5.7-3.8 9.2-3.8h317.4c5.8 0 8.7 7 4.6 11.1l-62.7 62.7c-2.4 2.4-5.7 3.8-9.2 3.8H6.5c-5.8 0-8.7-7-4.6-11.1l62.7-62.7zM6.5 102.7h317.4c3.5 0 6.8-1.4 9.2-3.8l62.7-62.7C399.9 32.1 397 25 391.2 25H73.8c-3.5 0-6.8 1.4-9.2 3.8L1.9 91.6c-4.1 4.1-1.2 11.1 4.6 11.1zM391.2 142.6H73.8c-3.5 0-6.8 1.4-9.2 3.8L1.9 209.1c-4.1 4.1-1.2 11.1 4.6 11.1zM391.2 142.6H73.8c-3.5 0-6.8 1.4-9.2 3.8L1.9 209.1c-4.1 4.1-1.2 11.1 4.6 11.1z" fill="url(#g2)"/><defs><linearGradient id="g2" x1="0" y1="0" x2="1" y2="1"><stop stop-color="#14F195"/><stop offset="1" stop-color="#9945FF"/></linearGradient></defs></svg>
                GRAMVAULT <span style="font-size: 0.6em; background: #222; padding: 2px 4px; border-radius: 3px; border: 1px solid #333; margin-left: 5px; color: #888;">PRO</span>
            </div>
            
            <div class="nav-items">
                <div class="nav-link active">Terminal</div>
                <div class="nav-link">Analytics</div>
                <div class="nav-link" onclick="Engine.toggle('view-docs', true)">Strategies</div>
            </div>

            <div class="flex items-center gap-4">
                <div class="badge badge-live hidden-mobile"><div class="pulse-dot"></div> MAINNET</div>
                <div class="text-mono text-xs text-muted hidden-mobile" id="clock">00:00:00</div>
                <button class="btn btn-primary" onclick="Engine.openWithdraw()">
                    <svg class="icon icon-sm" viewBox="0 0 24 24"><path d="M21 12V7H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h16v7zm-3 2a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm3-2v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7h18z"/></svg>
                    WITHDRAW
                </button>
            </div>
        </header>

        <div class="workspace">
            
            <aside class="sidebar">
                <div style="padding: 20px;">
                    <div class="text-xs text-muted uppercase" style="margin-bottom: 10px;">Account Summary</div>
                    <div class="card" style="padding: 15px; margin-bottom: 20px;">
                        <div class="text-sm text-muted">Estimated Value</div>
                        <div class="text-mono text-green" style="font-size: 1.2rem; font-weight: 700;">$<span id="side-usd">0.00</span></div>
                        <div class="text-xs text-muted" style="margin-top: 5px;">Wallet: 8x...3J9a</div>
                    </div>

                    <div class="text-xs text-muted uppercase" style="margin-bottom: 10px;">Market Watch</div>
                    <div id="watchlist"></div>
                </div>
            </aside>

            <main class="main-view">
                
                <div class="card hero-section">
                    <div>
                        <div class="text-sm text-muted uppercase">Net Liquidity</div>
                        <div class="bal-val"><span id="main-bal">0.0000</span> SOL</div>
                        <div class="bal-pnl">
                            <svg class="icon icon-sm" viewBox="0 0 24 24"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>
                            <span id="main-pnl">0.0000</span> (24h)
                        </div>
                    </div>
                    <div class="text-right hidden-mobile">
                        <div class="text-xs text-muted">Daily Yield Target</div>
                        <div class="text-mono text-green" style="font-size: 1.2rem;">2.40 SOL</div>
                    </div>
                </div>

                <div class="card">
                    <div class="panel-header">
                        <span>SOL/USDC PERFORMANCE</span>
                        <div class="flex gap-2">
                            <span class="badge">15M</span>
                            <span class="badge badge-live">LIVE</span>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="chart-canvas"></canvas>
                    </div>
                </div>

                <div class="card">
                    <div class="panel-header">EXECUTION LEDGER</div>
                    <div id="tx-log"></div>
                </div>

            </main>

            <aside class="sidebar-right">
                <div class="panel-header">ALPHA FEED</div>
                <div id="feed-container" style="flex: 1; padding: 10px;">
                    </div>
            </aside>

        </div>
    </div>

    <script>
        /**
         * GRAMVAULT ENGINE v7.0
         * Handles Logic, Math, Charts, and DOM interactions.
         */
        
        const Engine = {
            // Configuration
            // START_EPOCH: Jan 1, 2026. Ensures consistent math for all users.
            START_EPOCH: 1767225600000, 
            BASE_BALANCE: 30.00,
            DAILY_YIELD: 2.40,
            
            // State
            chartData: [],
            
            init() {
                this.initCanvas();
                this.genHistory();
                this.renderWatchlist();
                this.startFeed();
                
                // Keyboard Listeners for Login
                const keyInput = document.getElementById('inp-key');
                keyInput.addEventListener("keypress", function(event) {
                    if (event.key === "Enter") {
                        event.preventDefault();
                        Engine.login();
                    }
                });

                // Clock Loop
                setInterval(() => {
                    const now = new Date();
                    document.getElementById('clock').innerText = now.toISOString().split('T')[1].split('.')[0] + " UTC";
                }, 1000);
            },

            // --- MATH & DATA ---
            calculate() {
                const now = Date.now();
                // Ensure positive number even if system clock is weird
                const diff = Math.max(0, now - this.START_EPOCH);
                
                const daysElapsed = diff / (1000 * 60 * 60 * 24);
                
                // Deterministic Growth (2.4 per day)
                const organicGrowth = daysElapsed * this.DAILY_YIELD;
                
                // Add noise (Sine waves) to make it look "alive" but stay on trend
                const noise = (Math.sin(diff / 5000) * 0.02) + (Math.cos(diff / 1300) * 0.01);
                
                const total = this.BASE_BALANCE + organicGrowth + noise;
                
                // PnL for "Today"
                const secondsToday = (now % 86400000) / 1000;
                const pnlToday = (secondsToday / 86400) * this.DAILY_YIELD;

                return {
                    sol: total,
                    usd: total * 148.52, // Mock price
                    pnl: pnlToday
                };
            },

            // --- AUTH ---
            login() {
                const u = document.getElementById('inp-id').value;
                const p = document.getElementById('inp-key').value;
                const btn = document.querySelector('#view-login .btn-primary');
                const err = document.getElementById('login-err');
                const modalBox = document.getElementById('login-modal-box');

                if(u === "Groovy9944" && p === "user39zxnlojp") {
                    btn.innerText = "AUTHENTICATED";
                    btn.style.background = "#fff";
                    btn.style.color = "#000";
                    
                    // Fade out login modal
                    document.getElementById('view-login').style.transition = "opacity 0.5s ease";
                    document.getElementById('view-login').style.opacity = '0';
                    
                    setTimeout(() => {
                        document.getElementById('view-login').style.display = 'none';
                        // Fade in main app
                        const app = document.getElementById('main-app');
                        app.style.opacity = '1';
                        this.startLive();
                    }, 500);
                } else {
                    err.innerText = "ACCESS DENIED: INVALID CREDENTIALS";
                    modalBox.classList.add('shake-anim');
                    setTimeout(() => modalBox.classList.remove('shake-anim'), 400);
                }
            },

            // --- MAIN LOOP ---
            startLive() {
                setInterval(() => {
                    const data = this.calculate();
                    
                    // DOM Updates
                    document.getElementById('main-bal').innerText = data.sol.toFixed(4);
                    document.getElementById('main-pnl').innerText = "+" + data.pnl.toFixed(4);
                    document.getElementById('side-usd').innerText = data.usd.toLocaleString('en-US', {minimumFractionDigits: 2});
                    
                    // Chart
                    this.updateChart(data.sol);

                    // Random Activity
                    if(Math.random() > 0.8) this.addLog();

                }, 1000);
            },

            // --- WITHDRAWAL LOGIC ---
            openWithdraw() {
                const data = this.calculate();
                document.getElementById('modal-bal').innerText = data.sol.toFixed(4) + " SOL";
                this.toggle('view-withdraw', true);
            },

            submitWithdraw() {
                this.toggle('view-withdraw', false);
                this.toggle('view-loading', true);
                
                // Cinematic Loading Sequence
                const steps = [
                    { id: 's1', time: 1000 }, // Wallet
                    { id: 's2', time: 2500 }, // Liquidity
                    { id: 's3', time: 4500 }, // Risk
                    { id: 's4', time: 6500 }  // Collateral (Triggers error)
                ];

                steps.forEach(step => {
                    setTimeout(() => {
                        const el = document.getElementById(step.id);
                        if(step.id === 's4') {
                            el.classList.add('active'); // Just active, not done yet
                        } else {
                            el.classList.add('done');
                            el.querySelector('span:last-child').innerText = "VERIFIED";
                        }
                    }, step.time);
                });

                // Final Error Trigger
                setTimeout(() => {
                    this.toggle('view-loading', false);
                    this.toggle('view-error', true);
                    // Reset steps for next time
                    steps.forEach(s => {
                        const el = document.getElementById(s.id);
                        el.classList.remove('done', 'active');
                        el.querySelector('span:last-child').innerText = "WAITING";
                    });
                }, 7500);
            },

            toggle(id, state) {
                const el = document.getElementById(id);
                if(state) {
                    el.classList.remove('hidden');
                } else {
                    el.classList.add('hidden');
                }
            },

            // --- UI GENERATORS ---
            renderWatchlist() {
                const coins = [
                    { s: 'SOL', p: '$148.52', c: '+2.4%', up: true },
                    { s: 'JUP', p: '$1.12', c: '+5.1%', up: true },
                    { s: 'BONK', p: '$0.00002', c: '-1.2%', up: false }
                ];
                const con = document.getElementById('watchlist');
                coins.forEach(c => {
                    con.innerHTML += `
                    <div class="list-item">
                        <div style="font-weight:600">${c.s}</div>
                        <div style="text-align:right">
                            <div>${c.p}</div>
                            <div class="${c.up ? 'text-green' : 'text-red'} text-xs">${c.c}</div>
                        </div>
                    </div>`;
                });
            },

            startFeed() {
                const msgs = [
                    { t: "Whale Alert: 400 SOL buy on $WIF", i: "ðŸŒŠ" },
                    { t: "Liquidity Added: $PEPE / SOL", i: "ðŸ’§" },
                    { t: "Sniper Bot: 8x...29 just bought", i: "âš¡" },
                    { t: "Trend: Solana Volume up 14%", i: "ðŸ“ˆ" }
                ];
                const con = document.getElementById('feed-container');
                setInterval(() => {
                    const m = msgs[Math.floor(Math.random() * msgs.length)];
                    const div = document.createElement('div');
                    div.className = 'list-item';
                    div.style.border = 'none';
                    div.innerHTML = `
                        <div style="display:flex; gap:10px; align-items:center;">
                            <div style="font-size:1.2rem">${m.i}</div>
                            <div>
                                <div class="text-sm">${m.t}</div>
                                <div class="text-xs text-muted">Just now</div>
                            </div>
                        </div>`;
                    con.prepend(div);
                    if(con.children.length > 6) con.lastChild.remove();
                }, 3500);
            },

            addLog() {
                const con = document.getElementById('tx-log');
                const types = ['ARB', 'MEV', 'LIQ'];
                const type = types[Math.floor(Math.random() * types.length)];
                const amt = (Math.random() * 2).toFixed(2);
                const hash = Math.random().toString(36).substring(2,10);
                
                const div = document.createElement('div');
                div.className = 'list-item';
                div.innerHTML = `
                    <div class="flex gap-2">
                        <span class="badge ${type==='ARB'?'badge-live':''}">${type}</span>
                        <span>SOL-USDC</span>
                    </div>
                    <div class="flex gap-4">
                        <span class="text-green">+${amt} SOL</span>
                        <span class="text-mono text-muted text-xs">${hash}...</span>
                    </div>
                `;
                con.prepend(div);
                if(con.children.length > 5) con.lastChild.remove();
            },

            // --- CANVAS CHART ---
            genHistory() {
                let t = Date.now() - (100 * 1000);
                for(let i=0; i<100; i++) {
                    t += 1000;
                    const diff = Math.max(0, t - this.START_EPOCH);
                    const val = this.BASE_BALANCE + (diff / 86400000 * this.DAILY_YIELD) + (Math.sin(diff/5000)*0.02);
                    this.chartData.push(val);
                }
            },

            updateChart(val) {
                this.chartData.push(val);
                if(this.chartData.length > 100) this.chartData.shift();
                
                const cvs = document.getElementById('chart-canvas');
                const ctx = cvs.getContext('2d');
                cvs.width = cvs.clientWidth; cvs.height = cvs.clientHeight;
                const w = cvs.width; const h = cvs.height;
                
                const min = Math.min(...this.chartData);
                const max = Math.max(...this.chartData);
                const range = max - min || 1;

                ctx.clearRect(0,0,w,h);
                
                // Grid Lines
                ctx.strokeStyle = "rgba(255,255,255,0.05)";
                ctx.lineWidth = 1;
                ctx.beginPath();
                for(let i=1; i<4; i++) {
                    let y = (h/4)*i;
                    ctx.moveTo(0, y); ctx.lineTo(w, y);
                }
                ctx.stroke();

                // Path
                ctx.beginPath();
                this.chartData.forEach((v, i) => {
                    const x = (i / 99) * w;
                    const y = h - ((v - min) / range) * (h - 40) - 20;
                    if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
                });
                
                ctx.strokeStyle = "#14F195";
                ctx.lineWidth = 2;
                ctx.lineJoin = "round";
                ctx.stroke();

                // Gradient Fill
                ctx.lineTo(w, h); ctx.lineTo(0, h);
                const grad = ctx.createLinearGradient(0,0,0,h);
                grad.addColorStop(0, "rgba(20,241,149,0.1)");
                grad.addColorStop(1, "rgba(20,241,149,0)");
                ctx.fillStyle = grad;
                ctx.fill();
            },
            
            initCanvas() {
                // Background Particles
                const cvs = document.getElementById('bg-canvas');
                const ctx = cvs.getContext('2d');
                
                const resize = () => { cvs.width = window.innerWidth; cvs.height = window.innerHeight; };
                window.addEventListener('resize', resize);
                resize();

                const parts = Array.from({length: 40}, () => ({
                    x: Math.random() * cvs.width,
                    y: Math.random() * cvs.height,
                    vx: (Math.random() - 0.5) * 0.5,
                    vy: (Math.random() - 0.5) * 0.5,
                    s: Math.random() * 2
                }));

                const loop = () => {
                    ctx.clearRect(0,0,cvs.width,cvs.height);
                    ctx.fillStyle = "#14F195";
                    parts.forEach(p => {
                        p.x += p.vx; p.y += p.vy;
                        if(p.x < 0 || p.x > cvs.width) p.vx *= -1;
                        if(p.y < 0 || p.y > cvs.height) p.vy *= -1;
                        ctx.globalAlpha = 0.2;
                        ctx.beginPath(); ctx.arc(p.x, p.y, p.s, 0, Math.PI*2); ctx.fill();
                    });
                    requestAnimationFrame(loop);
                };
                loop();
            }
        };

        // Boot
        window.addEventListener('load', () => Engine.init());

    </script>
</body>
</html>
